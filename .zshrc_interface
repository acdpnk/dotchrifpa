# allow for functions in the prompt
	
	setopt PROMPT_SUBST

# general environment

	AUTO_CD=true
	autoload -U colors && colors

# i found this one and don't quite grasp it yet. when changing directories it checks whether the current terminal is an xterm window or *something* (?) similar, and if so prints current directory to the title bar.

	chpwd() {
		[[ -t 1 ]] || return
		case $TERM in
		sun-cmd) print -Pn "\e]l%~\e\\"
		;;
		*xterm*|rxvt|(dt|k|E)term) print -Pn "\e]2; [%n@%M]   [/dev/%y]   [$(pwd)] \a"
		;;
		esac
		}
	chpwd #calling it so that the title bar is as designed directly after logging in

# functions

	function activejobs {
		if [[ $(jobs | grep -i -c -e ".+" ) -ne 0 ]]; then
			echo "!"
		fi
	}
	function isgit {
		git branch &>/dev/null && echo 1 && return
		echo 0
	}

	function gitisclean {
		if [[ $(isgit) == "1" ]] && [[ $(git status 2>&1 | grep -c clean) == "0" ]]; then
			echo %{$fg_bold[white]%}•%{$reset_color%}
		fi
	}

	function gitbranch {
		if [[ $(isgit) == "1" ]]; then
			echo -n ' on '
			echo %{$fg[cyan]%}$(git rev-parse --abbrev-ref HEAD 2>/dev/null)%{$reset_color%}
		fi
	}

	function prompt_char {
		if [[ $UID == 0 ]]; then
			echo '#'
			return
		fi
		git branch >/dev/null 2>/dev/null && echo '±' && return
	#	hg root >/dev/null 2>/dev/null && echo '☿' && return
		echo '$'
	}


	function batperc {
		if [[ $(hostname) == "sirius" ]]; then
			if [[ $(pmset -g batt | grep -i -c "Discharging") != "1" ]]; then
				charge='⚡ '
			else
				charge=''
			fi
			if [[ $(pmset -g batt | grep -i -c "warning") == "1" ]]; then
				charge=%{$fg_bold[red]%}'!'%{$reset_color%}
			fi
			echo '['$(pmset -g batt | grep -E -o "1?[0-9]?[0-9]%" | sed s/"%"/"%%"/)$charge']'
		fi
	}

        function statuschar {
                if [[ $last_status != 0 ]]; then
                    echo %{$fg_bold[red]%}$last_status%{$reset_color%}
                else
                    echo $last_status
                fi
        }
        function remember_status {
            export last_status=$?
        }
# prompt

	PROMPT=$'$(remember_status)
┌[%{$fg[magenta]%}%n%{$reset_color%}@%{$fg[yellow]%}%m%{$reset_color%}][%{$fg[green]%}%c%{$reset_color%}$(gitbranch)$(gitisclean)]
└[%(?.%?.%{$fg_bold[red]%}%?%{$reset_color%})]$(activejobs)$(prompt_char)> '
	PS2=$' ~> ' 
	RPROMPT='[%T]$(batperc)'


